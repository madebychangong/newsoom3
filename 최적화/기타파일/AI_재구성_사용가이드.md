# AI 재구성 기능 사용가이드

## 📋 완성된 기능

### 1. 기본 최적화 (AI 없이)
- ✅ # 제목 자동 삭제
- ✅ 키워드+조사 제거 (키워드를 → 키워드)
- ✅ 키워드 출현 감소 (5-6회 → 2회)
- ✅ 금칙어 85개 자동 치환 (금칙어 리스트.xlsx 기반)
- ✅ AI 표현 다양화
- ✅ 자연스러운 변형

### 2. AI 재구성 (선택 기능)
- ✅ Gemini API 연동
- ✅ 자연스러운 블로그 말투로 재작성
- ✅ "~요" 반복 최소화 (최대 30%)
- ✅ 다양한 문장 종결어미 사용
- ✅ 금칙어 회피 유지
- ✅ 키워드 출현 2-3회 유지

---

## 🚀 사용 방법

### 방법 1: GUI 사용 (추천)

```bash
python3 blog_optimizer_gui.py
```

**AI 재구성 사용하기:**
1. 엑셀 파일 선택
2. "🤖 AI 자연스러운 재구성 사용" 체크박스 선택
3. Gemini API 키 입력 (또는 환경변수 설정)
4. "최적화 시작" 클릭

### 방법 2: 환경변수로 API 키 설정

```bash
# API 키 설정
export GEMINI_API_KEY='your-api-key-here'

# GUI 실행
python3 blog_optimizer_gui.py
```

이제 GUI에서 API 키를 입력하지 않아도 자동으로 환경변수에서 읽어옵니다.

### 방법 3: Python 스크립트

```python
from search_optimizer import SearchOptimizer

# AI 재구성 없이
optimizer = SearchOptimizer(use_ai=False)
result = optimizer.optimize_for_search(text, keyword)

# AI 재구성 포함
optimizer_ai = SearchOptimizer(
    use_ai=True,
    gemini_api_key='your-api-key'
)
result_ai = optimizer_ai.optimize_for_search(text, keyword)
```

---

## 🔑 Gemini API 키 발급 방법

1. https://aistudio.google.com/app/apikey 접속
2. Google 계정으로 로그인
3. "Create API Key" 클릭
4. API 키 복사

**무료 사용량:**
- 월 60회 요청 (분당 15회)
- 개인 프로젝트에 충분

---

## 📊 최적화 예시

### 입력 (원본)
```
# 팔꿈치 쿠션 보호대 후기
팔꿈치 쿠션 보호대를 최근에 알게 되어서 진짜 고민이네요.
사실 저는 무릎 통증으로 불편함을 느끼는 50대인데요,
의자에서 일어날 때마다 "아이고" 소리가 절로 나올 정도로 힘들어요.
팔꿈치 쿠션 보호대가 관절 통증에 효과가 있다는 이야기를 들었는데,
정말 가격 대비 효과가 있을지 의심이 들어서 궁금해요.
병원에서 진단을 받아야 할지 고민이네요.
```

**문제점:**
- ❌ # 제목 포함
- ❌ 키워드 3회 출현 (너무 많음)
- ❌ 키워드+조사 사용 ("보호대를", "보호대가")
- ❌ 금칙어 6개 포함 (네요, 효과, 가격, 의심, 병원, 진단)
- ❌ "~네요" 반복으로 어색함

### 출력 1: 기본 최적화 (AI 없음)
```
팔꿈치 쿠션 보호대 최근에 알게 되어서 진짜 고민이고….
사실 저는 무릎 통증으로 불편함을 느끼는 50대인데요,
의자에서 일어날 때마다 "아이고" 소리가 절로 나올 정도로 힘들어요.
팔꿈치 쿠션 보호대 먹으면 관절 통증에 약효가 있다는 이야기를 들었는데,
확실히 금액 대비 약효가 있을지 못 믿겠고이 들어서 궁금해요.
내과에서 확진을 받아야 할지 고민이고….
```

**개선사항:**
- ✅ # 제목 삭제
- ✅ 키워드 2회로 감소
- ✅ 키워드+조사 제거
- ✅ 금칙어 6개 치환:
  - 네요 → 고…
  - 효과 → 약효
  - 가격 → 금액
  - 의심 → 못 믿겠고
  - 병원 → 내과
  - 진단 → 확진

**한계:**
- ⚠️ 단순 치환으로 일부 어색한 표현 ("못 믿겠고이")

### 출력 2: AI 재구성 포함 (예상)
```
팔꿈치 쿠션 보호대 알게 되면서 고민이 많아졌어요.
저는 무릎 통증 때문에 불편한 50대거든요.
의자에서 일어날 때마다 "아이고" 소리가 절로 나오더라고요.
팔꿈치 쿠션 보호대 사용하면 관절 통증에 도움된다는 얘기 들었는데,
실제로 금액 대비 괜찮은지 궁금하답니다.
전문가 상담받아볼까 생각 중이에요.
```

**추가 개선:**
- ✅ 자연스러운 문장 흐름
- ✅ 다양한 종결어미 (어요/거든요/더라고요/답니다/에요)
- ✅ "~요" 반복 최소화
- ✅ 어색한 표현 자동 수정
- ✅ 금칙어 회피 유지

---

## 🧪 테스트 방법

### 1. 데모 실행
```bash
python3 test_ai_rewriter_demo.py
```

기본 최적화와 AI 재구성을 비교할 수 있습니다.

### 2. 단일 파일 테스트
```bash
python3 quick_test.py
```

### 3. 템플릿 비교 테스트
```bash
python3 test_template_comparison.py
```

20개 샘플과 비교하여 정확도를 확인합니다.

---

## 📁 주요 파일 설명

| 파일 | 설명 |
|------|------|
| `search_optimizer.py` | 검색 최적화 메인 로직 (키워드 감소, 조사 제거) |
| `blog_optimizer.py` | 기본 최적화 (금칙어 치환, AI 표현 다양화) |
| `forbidden_words_loader.py` | 금칙어 리스트.xlsx 로더 (85개 금칙어) |
| `ai_rewriter.py` | **NEW** Gemini API 기반 자연스러운 재구성 |
| `blog_optimizer_gui.py` | GUI 애플리케이션 (AI 옵션 포함) |
| `금칙어 리스트.xlsx` | 금칙어 85개 + 대체어 목록 |
| `작업 의뢰용 데이터.xlsx` | 실제 작업용 엑셀 템플릿 |

---

## 💰 비용 안내

### Gemini API 무료 사용량
- **분당 요청:** 15회
- **일일 요청:** 1,500회
- **월 요청:** 무제한 (속도 제한만 있음)

### 예상 비용
- 블로그 원고 1개: 약 1회 API 호출
- 엑셀 100개 행: 약 100회 API 호출 (무료)

**결론:** 개인 블로그 작업에는 무료 플랜으로 충분합니다.

---

## ⚙️ 고급 설정

### AI 프롬프트 커스터마이징

`ai_rewriter.py` 파일의 `create_prompt()` 메서드에서 프롬프트를 수정할 수 있습니다:

```python
def create_prompt(self, text: str, keyword: str) -> str:
    """재구성 프롬프트 생성"""

    # 금칙어 리스트 수정 가능
    forbidden_words = [
        "네요", "가격", "광고", ...
    ]

    # 프롬프트 내용 수정 가능
    prompt = f"""당신은 네이버 블로그 글을 자연스럽게 재구성하는 전문가입니다.
    ...
    """
```

### 키워드 출현 횟수 조절

`search_optimizer.py`에서 목표 횟수를 변경할 수 있습니다:

```python
# 3. 키워드 출현 감소 (2-3회 목표)
text = self.reduce_keyword_frequency(text, keyword, target_count=2)  # 여기 수정
```

---

## 🐛 문제 해결

### Q1: "GEMINI_API_KEY 환경변수를 설정해주세요" 오류
**A:** API 키를 설정하지 않았습니다.
```bash
export GEMINI_API_KEY='your-api-key-here'
```

### Q2: "금칙어 리스트 로드 실패" 오류
**A:** `금칙어 리스트.xlsx` 파일이 없거나 경로가 잘못되었습니다.
```bash
ls -la "금칙어 리스트.xlsx"  # 파일 확인
```

### Q3: AI 재구성이 너무 느림
**A:** Gemini API의 속도 제한 때문입니다. 대용량 작업 시:
1. AI 재구성을 선택적으로 사용 (중요한 원고만)
2. 배치 작업 시 sleep 추가
3. 기본 최적화만 사용

### Q4: 금칙어가 제대로 치환되지 않음
**A:** `금칙어 리스트.xlsx` 파일을 확인하세요:
1. 컬럼 구조: Unnamed: 1 (금칙어), Unnamed: 2~ (대체어)
2. 긴 패턴이 먼저 처리됨 ("광고가" → "광고")

---

## 📞 지원

문제가 발생하면:
1. `test_ai_rewriter_demo.py` 실행하여 기본 동작 확인
2. 로그 메시지 확인
3. 에러 메시지와 함께 문의

---

## 🎯 다음 단계

1. **Gemini API 키 발급** → https://aistudio.google.com/app/apikey
2. **테스트 실행** → `python3 test_ai_rewriter_demo.py`
3. **GUI로 실제 작업** → `python3 blog_optimizer_gui.py`
4. **결과 확인 및 비교**

AI 재구성은 선택 기능이므로, 먼저 기본 최적화로 테스트해보고 필요시 AI를 활성화하세요!
