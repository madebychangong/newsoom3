# 원고 자동화 개선 사항 비교

## 🔴 기존 버전의 문제점

### 1. 프롬프트가 너무 길고 복잡 (120줄)
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 최우선 목표: 키워드 개수 맞추기 (절대 필수!)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️ 아래 키워드 개수를 정확히 맞춰주세요...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚫 다음 목표: 금칙어 치환 (필수!)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

... (이하 100줄 더)
```
→ **AI가 중요한 규칙을 놓칠 확률 높음**

### 2. 애매한 표현 사용
```
- "최소 2개 이상" → AI가 2개? 3개? 헷갈림
- "많아도 OK" → 정확히 몇 개까지?
- "~관련해서 알아보는 중" → 예시가 너무 많아 본질 흐림
```

### 3. 우선순위 불명확
```
7개 규칙 + 금칙어 + 글 구조 + 자연스러움 + 예시
→ AI가 뭘 먼저 지켜야 할지 모름
```

### 4. 재시도 로직 약함
- 1차 실패 → 2차 시도 → 끝
- 개선 여지가 적음

---

## 🟢 개선된 버전 (v2)

### 1. 프롬프트 극단적 단순화 (30줄)
```python
"""블로그 원고를 수정하세요.

【최우선 규칙】
1. 키워드는 반드시 띄어쓰기로 분리: [팔꿈치 쿠션 보호대 ] (공백 필수!)
   ❌ 나쁜 예: 팔꿈치 쿠션 보호대를
   ✅ 좋은 예: 팔꿈치 쿠션 보호대 관련

2. 아래 작업을 정확한 개수로 수행:

   1. 첫 문단에 [팔꿈치 쿠션 보호대] 를 1개 더 추가하세요. (현재 1개 → 목표 정확히 2개)
   2. 줄 맨 앞에서 [팔꿈치 쿠션 보호대]로 시작하는 문장을 1개 더 만드세요. (현재 1개 → 목표 정확히 2개)
   3. 첫 문단 이후에 [보호대] 를 1개 추가하세요. (현재 0개 → 목표 정확히 1개)

【원본 원고】
...

【출력 규칙】
- 수정된 원고만 출력 (설명 없이)
"""
```

### 2. 명확한 숫자 지시
```
❌ 기존: "최소 2개 이상 (많아도 OK)"
✅ 개선: "정확히 2개" 또는 "1개 더 추가"

→ AI가 정확히 무엇을 해야 할지 명확함
```

### 3. 우선순위 단순화
```
1순위: 키워드 개수 (숫자만 정확히!)
2순위: 글자수
3순위: 자연스러움 (나중에)

→ 단계별로 하나씩 해결
```

### 4. 재시도 강화
```python
max_retries=3  # 기본 3회

for attempt in range(1, max_retries + 1):
    # 이전 시도 결과를 다음 시도에 활용
    manuscript = rewritten  # 점진적 개선
```

---

## 📊 비교표

| 항목 | 기존 (v1) | 개선 (v2) | 효과 |
|------|-----------|-----------|------|
| **프롬프트 길이** | 120줄 | 30줄 | ⬇️ 75% 감소 |
| **지시 명확성** | "최소 2개 이상" | "정확히 2개" | ✅ 100% 명확 |
| **우선순위** | 불명확 (7개 동시) | 명확 (숫자 → 글자수 → 자연스러움) | ✅ 단계별 처리 |
| **재시도 횟수** | 2회 | 3회 (설정 가능) | ⬆️ 50% 증가 |
| **점진적 개선** | ❌ 없음 | ✅ 이전 결과 활용 | ⬆️ 성공률 향상 |
| **예시 개수** | 15개+ | 2개 | ⬇️ 노이즈 감소 |

---

## 🎯 핵심 개선 전략

### 1. "규칙 먼저, 자연스러움은 나중에"
```
기존: 규칙 + 자연스러움을 동시에 요구 → AI 혼란
개선: 규칙만 먼저 100% 충족 → 자연스러움은 2차 수정
```

### 2. "Python이 계산, AI는 실행만"
```python
# Python이 정확히 계산
if 첫문단_count < 2:
    tasks.append(f"[{keyword}] 를 {2 - 첫문단_count}개 더 추가")

# AI는 숫자만 따라하면 됨
→ "1개 더 추가하세요" (명확!)
```

### 3. "짧고 명확한 프롬프트"
```
기존: 120줄의 장황한 설명
개선: 30줄의 핵심만 전달

→ AI의 주의력 집중도 향상
```

---

## 📝 사용법

### 기존 버전 (auto_manuscript_rewriter.py)
```python
from auto_manuscript_rewriter import AutoManuscriptRewriter

rewriter = AutoManuscriptRewriter(gemini_api_key=api_key)
result = rewriter.rewrite_manuscript(...)
```

### 개선 버전 (auto_manuscript_rewriter_v2.py)
```python
from auto_manuscript_rewriter_v2 import AutoManuscriptRewriterV2

rewriter = AutoManuscriptRewriterV2(gemini_api_key=api_key)
result = rewriter.rewrite_manuscript(
    manuscript=manuscript,
    keyword=keyword,
    target_whole_str=target_whole,
    target_pieces_str=target_pieces,
    target_subkeywords=target_subkeywords,
    max_retries=3  # 재시도 횟수 설정 가능
)
```

---

## ✅ 예상 효과

1. **규칙 충족률 향상**: 60% → 90%+
2. **재시도 성공률 향상**: 점진적 개선으로 누적 성공
3. **AI 혼란 감소**: 프롬프트 단순화로 정확도 향상
4. **처리 속도 개선**: 불필요한 설명 제거

---

## 🚀 다음 단계

1. **v2로 테스트 실행**
   ```bash
   python test_elbow_cushion_v2.py
   ```

2. **기존 vs 개선 비교**
   - 같은 원고로 두 버전 실행
   - 규칙 충족률 비교

3. **프롬프트 추가 최적화**
   - 실패 사례 분석
   - 프롬프트 미세 조정
